{% extends 'base.html' %}
{% load static %}

{% block content %}
<html>
<head>
    <title>Convert EXCEL files to JSON</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 600px;
            margin-top: 50px;
        }
        .file-upload {
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
        }
        .file-upload:hover {
            background-color: #3a3a3a;
        }
        .file-upload i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .file-upload p {
            margin: 0;
        }
        .file-upload span {
            display: block;
            margin-top: 5px;
            color: #888;
        }
        .file-upload .btn {
            background-color: #ff4d4d;
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .file-upload .btn:hover {
            background-color: #ff3333;
        }
        .uploaded-file {
            display: flex;
            align-items: center;
            margin-top: 20px;
            justify-content: space-between;
        }
        .uploaded-file i {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        .uploaded-file span {
            color: #888;
        }
        .uploaded-file .remove-file {
            color: #fff;
            margin-left: 10px;
            cursor: pointer;
        }
        .convert-btn {
            background-color: #333;
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            width: 100%;
        }
        .convert-btn:hover {
            background-color: #444;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <h1>Convert EXCEL files to JSON</h1>
        <p>Choose EXCEL files</p>
        <form id="excel-upload-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="file-upload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag and drop files here</p>
                <span>Limit 200MB per file • XLSX</span>
                <input type="file" name="files" multiple accept=".xlsx" class="form-control-file" style="display: none;" id="file-input">
                <button type="button" class="btn" onclick="document.getElementById('file-input').click();">Browse files</button>
            </div>
            <div id="uploaded-files" class="mt-3"></div>
            <p id="file-count">You have uploaded 0 files.</p>
            <button type="submit" class="convert-btn">Convert to JSON</button>
        </form>
    </div>
    <script>
        const fileInput = document.getElementById('file-input');
        const uploadedFilesContainer = document.getElementById('uploaded-files');
        const fileCountText = document.getElementById('file-count');

        fileInput.addEventListener('change', (event) => {
            const files = event.target.files;
            uploadedFilesContainer.innerHTML = ''; // Clear previous files
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileDiv = document.createElement('div');
                fileDiv.className = 'uploaded-file';
                fileDiv.innerHTML = `
                    <i class="fas fa-file-alt"></i>
                    <p>${file.name}</p>
                    <span>${(file.size / 1024).toFixed(2)} KB</span>
                    <i class="fas fa-times remove-file" onclick="removeFile(this)"></i>
                `;
                uploadedFilesContainer.appendChild(fileDiv);
            }
            fileCountText.innerText = `You have uploaded ${files.length} file${files.length > 1 ? 's' : ''}.`;
        });

        function removeFile(element) {
            const fileDiv = element.parentElement;
            const index = Array.from(uploadedFilesContainer.children).indexOf(fileDiv);
            const dt = new DataTransfer(); // Create a DataTransfer object to manage the file list

            for (let i = 0; i < fileInput.files.length; i++) {
                if (i !== index) {
                    dt.items.add(fileInput.files[i]); // Add the other files to the DataTransfer object
                }
            }

            fileInput.files = dt.files; // Update the input's file list
            uploadedFilesContainer.removeChild(fileDiv); // Remove the file from the display
            fileCountText.innerText = `You have uploaded ${fileInput.files.length} file${fileInput.files.length > 1 ? 's' : ''}.`;
        }
    </script>
</body>
</html>
{% endblock %}




{% comment %} {% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .custom-button {
        border: 1px solid rgb(53, 37, 142); /* Tạo viền màu đen bao quanh */
        color: blue; /* Chữ có màu xanh dương */
        padding: 5px 5px; /* Tạo khoảng cách giữa chữ và viền */
        background-color: rgb(224, 217, 217); /* Nền trắng */
        cursor: pointer; /* Đổi con trỏ chuột thành dạng pointer khi hover */
        font-size: 14px; /* Kích thước chữ */
    }

    .custom-button:hover {
        background-color: lightblue; /* Màu nền thay đổi khi hover */
    }

    .drop-zone {
        border: 2px dashed rgb(53, 37, 142);
        border-radius: 20px;
        padding: 60px;
        text-align: center;
        background-color: #f8f8f8;
        cursor: pointer;
    }

    .drop-zone.dragover {
        background-color: #667dae; /* Thay đổi màu nền khi kéo tệp qua */
    }

    .file-list {
        margin-top: 10px;
        list-style-type: none;
        padding: 0;
    }

    .file-list li {
        margin: 5px 0;
        font-size: 14px;
    }

    .text-right {
        text-align: right; /* Căn chỉnh sang bên phải */
    }
    .title {
        border: 2px solid rgb(125, 44, 9);
        font-size: 20px;
        background-color: rgb(236, 116, 90);
    }
    .remove-button {
    background: none; /* Không có nền */
    border: none; /* Không có viền */
    color: rgb(32, 25, 125); /* Màu chữ */
    font-size: 18px; /* Kích thước chữ */
    cursor: pointer; /* Đổi con trỏ chuột thành dạng pointer khi hover */
    margin-left: 10px; /* Khoảng cách giữa tên tệp và nút xóa */
    }

    .remove-button:hover {
    color: darkred; /* Thay đổi màu chữ khi hover */
    }z
</style>

<div class="card card-header title">
    <h1 class="text-center">Convert Excel Files to JSON</h1>
</div>
<div class="card card-body">
    <form method="post" enctype="multipart/form-data" id="upload-form">
        {% csrf_token %}
        <div class="drop-zone" id="drop-zone">
            Drag your excel file here! 
        </div>
        <input type="file" name="files" id="file-input" multiple style="display: none;"> <!-- Đảm bảo input file có thể chứa nhiều file -->
        <ul class="file-list" id="file-list"></ul> <!-- Thêm danh sách để hiển thị tệp -->
        <div class="text-right">
            <button type="submit" class="custom-button">Convert</button>
        </div>
    </form>
</div>
<div class="d-flex justify-content-end" style="margin-right: 20px;">
    <a href="{% url 'tools:view_tools' %}" class="btn btn-link">
        <i class="fas fa-arrow-left"></i> Back
    </a>
</div>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    let filesArray = []; // Mảng để lưu trữ các tệp hiện tại
    const validExtensions = ['.xlsx' ,'.xls']
// Khi người dùng nhấp vào vùng kéo thả, kích hoạt input để chọn tệp
dropZone.addEventListener('click', () => {
    fileInput.click();
});

// Khi người dùng kéo tệp vào vùng kéo thả
dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
});

// Khi người dùng kéo tệp ra khỏi vùng kéo thả
dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
});

// Khi người dùng thả tệp vào vùng kéo thả
dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');

    const droppedFiles = e.dataTransfer.files;
    addFilesToArray(droppedFiles); // Thêm tệp vào mảng và cập nhật danh sách hiển thị
});

// Khi người dùng chọn tệp từ hộp thoại
fileInput.addEventListener('change', () => {
    addFilesToArray(fileInput.files); // Thêm tệp vào mảng và cập nhật danh sách hiển thị
});

// Hàm thêm tệp vào mảng và cập nhật danh sách
function addFilesToArray(newFiles) {
        for (let i = 0; i < newFiles.length; i++) {
            const ext = newFiles[i].name.split('.').pop().toLowerCase(); // Lấy đuôi tệp
            if (!validExtensions.includes('.' + ext)) { // Kiểm tra định dạng
                alert(`Tệp '${newFiles[i].name}' không hợp lệ! Vui lòng chọn tệp Excel (.xls, .xlsx).`);
                continue; // Bỏ qua tệp không hợp lệ
            }
            if (!filesArray.some(file => file.name === newFiles[i].name)) { // Kiểm tra trùng tên tệp
                filesArray.push(newFiles[i]); // Thêm tệp vào mảng
            }
        }
        updateFileList();
    }

// Hàm cập nhật danh sách các tệp hiển thị trong vùng kéo thả
function updateFileList() {
    fileList.innerHTML = ''; // Xóa danh sách hiện tại

    filesArray.forEach((file, index) => {
        const listItem = document.createElement('li');
        listItem.textContent = file.name; // Hiển thị tên của từng tệp

        // Tạo nút xóa
        const removeButton = document.createElement('button');
        removeButton.textContent = '×'; // Dấu xóa
        removeButton.classList.add('remove-button'); // Thêm lớp CSS

        // Xử lý sự kiện khi nút xóa được nhấn
        removeButton.addEventListener('click', () => {
            // Xóa tệp khỏi mảng
            filesArray.splice(index, 1);
            updateFileList(); // Cập nhật danh sách hiển thị
            updateFileInput(); // Cập nhật lại input file
        });

        listItem.appendChild(removeButton); // Thêm nút xóa vào danh sách
        fileList.appendChild(listItem); // Thêm item vào danh sách
    });

    updateFileInput(); // Cập nhật lại input file
}

// Hàm cập nhật input file với danh sách tệp hiện tại
function updateFileInput() {
    const dataTransfer = new DataTransfer();
    filesArray.forEach(file => dataTransfer.items.add(file));
    fileInput.files = dataTransfer.files; // Cập nhật file input
}


</script>
{% endblock %} {% endcomment %}